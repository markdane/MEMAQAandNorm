
```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8,
                      echo=FALSE, warning=FALSE, message=FALSE)

```


```{r functions}
#Author: Mark Dane, copyright 2015

source("~/Documents/MEP-LINCS/MEPLINCSFunctions.R")

createl4KeepRaw <- function (l3) 
{
  #Select all signal names and the minimal metadata
  l4Names <- grep("^Ligand$|^ECMp$|Barcode|MEP|^Well$|StainingSet|_CP_|_PA_",x = names(l3), value = TRUE)
  #Remove the SE names
  l4Names <- grep("_SE", l4Names, value = TRUE, invert = TRUE)
  #Create a datatable of the signals and minimal metadata
  l4Keep <- l3[, l4Names, with = FALSE]
  l4DT <- l4Keep[, lapply(.SD, numericMedian), keyby = "Ligand,ECMp,MEP,Barcode,Well,StainingSet"]
  return(l4DT)
}

createPCAModel <- function(dt,fvNames){
  #delete any non-varying signals that cannot be scaled to unit variance
  stdDevs <- apply(dt[,fvNames, with=FALSE], 2, sd)
  if(any(stdDevs==0))  cat(paste("Deleting",fvNames[stdDevs==0], "due to 0 variance\n"))
  fvNames <- fvNames[!stdDevs==0]
  PCAModel <- prcomp(as.formula(paste(" ~ ", paste(fvNames, collapse = "+"))), data = dt, scale= TRUE)
  rownames(PCAModel$x)<-paste(dt$MEP,gsub("LI8X00","",dt$Barcode), sep="_")
  return(PCAModel)
}

plotPCs <- function(m, PCs, colour, title, legendTitle, xlim=NULL, ylim=NULL){
  if(!(length(PCs)==3&class(m)=="prcomp")) stop("PCs must have a length of 3 and m must be of class prcomp")
  p <- ggplot(data.frame(m$x), aes_string(x = PCs[1], y = PCs[2], colour = colour)) +
    geom_point(size = rel(.5), alpha = .5) +
    labs(colour = legendTitle)+
    ggtitle(title)+
    guides(colour=FALSE)+
    coord_cartesian(xlim=xlim, ylim=ylim)+
    theme(legend.text=element_text(size = 6),
          plot.title=element_text(size = rel(.7)))
    
    p <- p + geom_point(data=data.frame(m$x[grepl("FBS",rownames(m$x)),]),colour="black",size = rel(.3), alpha = .4)
  
  p <- p + geom_point(data=data.frame(m$x[grepl("NID1",rownames(m$x)),]),colour="white",size = rel(.4), alpha = .8)
  
  print(p)
  
  p <- ggplot(data.frame(m$x), aes_string(x = PCs[2], y = PCs[3], colour = colour)) +
    geom_point(size = rel(.5), alpha = .5) +
    labs(colour = legendTitle)+
    ggtitle(title)+
    guides(colour=FALSE)+
    #guides(colour = guide_legend(override.aes = list(size=6)))+
    coord_cartesian(xlim=xlim, ylim=ylim)+
    theme(legend.text=element_text(size = 6),
          plot.title=element_text(size = rel(.7)))

    p <- p + geom_point(data=data.frame(m$x[grepl("FBS",rownames(m$x)),]),colour="black",size = rel(.3), alpha = .4)
  
  p <- p + geom_point(data=data.frame(m$x[grepl("NID1",rownames(m$x)),]),colour="white",size = rel(.4), alpha = .8)
  
  print(p)
  
  p <- ggplot(data.frame(m$x), aes_string(x = PCs[1], y = PCs[3], colour = colour)) +
    geom_point(size = rel(.5), alpha = .5) +
    coord_cartesian(xlim=xlim, ylim=ylim)+
    labs(colour = legendTitle)+
    ggtitle(title)+
    guides(colour=FALSE)+
    #guides(colour = guide_legend(override.aes = list(size=6)))+
  theme(legend.text=element_text(size = 6),
        plot.title=element_text(size = rel(.7)))
    
    p <- p + geom_point(data=data.frame(m$x[grepl("FBS",rownames(m$x)),]),colour="black",size = rel(.3), alpha = .4)
  
  p <- p + geom_point(data=data.frame(m$x[grepl("NID1",rownames(m$x)),]),colour="white",size = rel(.4), alpha = .8)
  
  print(p)
  
}

plotScree <- function(m,nrPCs=9,main  = paste("PCA Scree Plot for",cellLine,ss)){
  var <- m$sd[1:nrPCs]^2
  var.percent <- var/sum(var) * 100
  barplot(var.percent, xlab="PC", ylab="Percent Variance", names.arg=1:length(var.percent), las=1, ylim=c(0,max(var.percent)), col="gray", main=main)
}


```


```{r setup,cache=FALSE}
library("ggplot2")
library("data.table")
library("MEMA")
library("grid")
library("knitr")
library("gplots")
library("RColorBrewer")
library(DT)
library(d3heatmap)
library(plotly)
library(corrplot)
library(RUVnormalize)
library(ruv)

#Setup colors for Barcode and text in all heatmaps
selDark2 <- colorRampPalette(brewer.pal(8,"Dark2"))
plateCol = selDark2(8)
hmcols<-colorRampPalette(c("blue","white","red"))(16)
#Read in the 3 level 3 datasets
#TOD: Remove the setwd command
setwd("~/Documents/MEP-LINCS/")
l3List <- apply(x, 1, function(fn){
  dt <- fread(paste0("./",fn[["cellLine"]],"/",fn[["ss"]],"/AnnotatedData/",fn[["cellLine"]], "_",fn[["ss"]],"_",fn[["rawDataVersion"]],"_",fn[["analysisVersion"]],"_Level3.txt"), showProgress = FALSE)
  dt$StainingSet <- fn[["ss"]]
  return(dt)
})

#identify the common signals
commonSignals <- intersect(intersect(colnames(l3List[[1]]),colnames(l3List[[2]])),colnames(l3List[[3]]))

#Combine the common signals into a datatable
l3c <- rbind(l3List[[1]][,commonSignals,with=FALSE],
             l3List[[2]][,commonSignals,with=FALSE],
             l3List[[3]][,commonSignals,with=FALSE])

#Remove NID1 spots
#l3c <- l3c[!grepl("NID",l3c$ECMp),]

#Remove normalized and spot level signals
l3c <- l3c[,grep("RUV3|_SE|Spot_PA_Perimeter|Spot_PA_ReplicateCount|BWL|SERC|^k$|NormMethod|SignalType",colnames(l3c),invert=TRUE, value=TRUE), with=FALSE]

#Remove blank spot data
#Retain NID1 until the method is proven
l3c <- l3c[!grepl("PBS|blank|Blank",l3c$ECMp)]

#Make the FBS in each plate unique
l3c$Ligand[grepl("FBS",l3c$Ligand)] <- paste0("FBS",gsub("LI8XXX00|LI8X00|reDAPI","",l3c$Barcode[grepl("FBS",l3c$Ligand)]))
l3c$MEP<- paste(l3c$ECMp,l3c$Ligand,sep="_")

#manual remove extreme value datapoints
l3c <- l3c[!grepl("VCAM1_FBS427",l3c$MEP),]

#RUV3 Normalize each signal
metadataNames <- grep("_CP_|_PA_|^ECMp|^Ligand|MEP|^ArrayRow$|^ArrayColumn$",colnames(l3c), value=TRUE, invert=TRUE)
#Save the metadata to merge in later
mdDT <- l3c[,metadataNames, with = FALSE]
#Identify parameters to be normalized
signalsWithMetadata <- grep("^Barcode$|^ECMp$|^Ligand$|^Well$|^Spot$|^PrintSpot$|^ArrayRow$|^ArrayColumn$|_CP_|_PA_",colnames(l3c),value=TRUE)
l3s <- l3c[,signalsWithMetadata, with=FALSE]

#Normalize each feature, pass with location and content metadata
if(verbose) cat("Normalizing\n") #save(slDT, file="slDT.RData") save(l3s, file="l3s.RData")
l3n <- normRUV3LoessResidualsCS(l3s, k)
#Run a second cycle of RUV3Loess on the common signals
l3nx2 <- MEMA:::normRUV3LoessResidualsCSx2(l3n,k)

#Merge back in the original raw and normalized data
l3nn <- merge(l3nx2,l3n, by=intersect(colnames(l3nx2),colnames(l3n)))

l3nn$NormMethod <- "RUV3LoessResidualsx2"

l3nn <- merge(l3nn,mdDT,by = c("Barcode","Well","Spot", "PrintSpot"))

l4 <- createl4KeepRaw(l3nn)

barcodes <- sort(unique(l4$Barcode))

#Set a threshold for filtering wells on their QA score
wellQAThresh <- 0.8

#TODO: Read this from Level 3 data
lthresh <- 0.6

#Number of PCS components to use
nrPCs <- 9

#Z score threshold for extreme spot cell count
SCCZscoreThresh <- 3

#Spot cell count threshold for HF dataset
HFSCCThresh <- 20

#Replicate count threshold for HF Dataset
HFRepThresh <- 3

# https://meplincs.ohsu.edu/webclient/

if(!analysisVersion=="v1"){
  l3nn$OmeroDetailURL <- paste0('<a href="https://meplincs.ohsu.edu/webclient/img_detail/',l3nn$ImageID,'/"',' target="_blank">Omero</a>')
  l3nn$OmeroThumbnailURL <- paste0('<a href="https://meplincs.ohsu.edu/webclient/render_thumbnail/',l3nn$ImageID,'/"',' target="_blank">Omero</a>')
  l3nn$OmeroImageURL <- paste0('<a href="https://meplincs.ohsu.edu/webclient/render_image/',l3nn$ImageID,'/"',' target="_blank">Omero</a>')
}

```


#MEP-LINCS `r cellLine` Phase 1 PCA Common Signal Normalization and Evaluation
####date: `r Sys.Date()`

##Summary
This analysis is of the DAPI-dervived signals which are common across three MEP-LINCS `r cellLine` staining sets. These signals include DAPI intensity and nuclear morphology. Each of the three staining set has fifty-six ligand wells and eight FBS control wells. The normalization treats the MEPs in the ligand wells as three replicates and the MEPS in the FBS wells as twenty-four replicates. The data is normalized as a matrix of 192 MEMAs in the rows and 694 spots in the columns. The normalization is a round of RUV3 using the spatial residuals as the controls and k=`r k` followed by a round of bivariate loess using spatial residuals after the RUV3 round and then a second round of RUV3 and loess that use the spaptial residuals in the same manner as the first. The Nidogen 1 MEPS have been colored white in the PCA plots.



```{r PCARawData, eval=TRUE}


###PCA Unbiased Analysis  
# The unbiased analysis is extended by using Principal Component Analysis (PCA) to reduce the dimensions of the feature vector.
# 
# The unbiased PCA analysis method is:
# Use PCA to transform the entire raw feature set to a much smaller number of principal components (PCFV).  
# Perform unsupervised hierarchical clustering of the first `r nrPCs` PCFVs.  
# 


#Get a PCA model from the raw data
rawFVNames <- grep("ECMp|Ligand|MEP|Barcode|Well|StainingSet|Loess|RUV3",colnames(l4),invert = TRUE, value = TRUE)
rawPCAModel <- createPCAModel(dt=l4, fvNames = rawFVNames)

#Get a PCA model from the RUV3 data
RUV3Names <- grep("Loess",grep("RUV3$",colnames(l4), value=TRUE),value=TRUE,invert=TRUE)
RUV3PCAModel <- createPCAModel(dt=l4, fvNames = RUV3Names)

#Get a PCA model from the RUV3Loess data
RUV3LoessNames <- grep("LoessRUV3",grep("RUV3Loess$",colnames(l4), value=TRUE), value=TRUE, invert=TRUE)
RUV3LoessPCAModel <- createPCAModel(dt=l4, fvNames = RUV3LoessNames)

#Get a PCA model from the RUV3LoessRUV3 data
RUV3LoessRUV3Names <- grep("RUV3LoessRUV3$",colnames(l4), value=TRUE)
RUV3LoessRUV3PCAModel <- createPCAModel(dt=l4, fvNames = RUV3LoessRUV3Names)

#Get a PCA model from the RUV3LoessRUV3Loess data
RUV3LoessRUV3LoessNames <- grep("RUV3LoessRUV3Loess$",colnames(l4), value=TRUE)
RUV3LoessRUV3LoessPCAModel <- createPCAModel(dt=l4, fvNames = RUV3LoessRUV3LoessNames)

```
<br>

###PCA Plots

The following scatter plots show various principal components of the MEPS after PCA of all signals. The state of all signals within a PCA model are the same, that is they are all raw or at the same level of normalization. Each MEP is colored by it's eight well plate. The FBS MEPs are colored black.  

<br>

```{r plotRawPCA, fig.height=3, fig.width=4}
plotScree(m = rawPCAModel, main=list("PCA Scree Plot of Raw Data",cex = .9))

plotPCs(m = rawPCAModel,PCs = c("PC1","PC2","PC3"),colour = "l4$Barcode", title = "PCA of Raw Data", legendTitle = "Barcode", xlim = c(-10,10), ylim=c(-10,10))

```

```{r plotRUV3PCA, fig.height=3, fig.width=4}
plotScree(m = RUV3PCAModel, main=list("PCA Scree Plot of RUV3 Normalized Data",cex = .9))

plotPCs(m = RUV3PCAModel,PCs = c("PC1","PC2","PC3"),colour = "l4$Barcode", title = "PCA of RUV3 Normalized Data", legendTitle = "Barcode", xlim = c(-10,10), ylim=c(-10,10))



```

```{r plotRUV3LoessPCA, fig.height=3, fig.width=4}
plotScree(m = RUV3LoessPCAModel, main=list("PCA Scree Plot of RUV3Loess Normalized Data",cex = .9))

plotPCs(m = RUV3LoessPCAModel,PCs = c("PC1","PC2","PC3"),colour = "l4$Barcode", title = "PCA of RUV3Loess Normalized Data", legendTitle = "Barcode", xlim = c(-10,10), ylim=c(-10,10))


```


```{r plotRUV3LoessRUV3PCA, fig.height=3, fig.width=4}
plotScree(m = RUV3LoessRUV3PCAModel, main=list("PCA Scree Plot of RUV3LoessRUV3 Normalized Data",cex = .9))

plotPCs(m = RUV3LoessRUV3PCAModel,PCs = c("PC1","PC2","PC3"),colour = "l4$Barcode", title = "PCA of RUV3LoessRUV3 Normalized Data", legendTitle = "Barcode", xlim = c(-10,10), ylim=c(-10,10))


```


```{r plotRUV3LoessRUV3LoessPCA, fig.height=3, fig.width=4}
plotScree(m = RUV3LoessRUV3LoessPCAModel, main=list("PCA Scree Plot of RUV3LoessRUV3Loess Normalized Data",cex = .9))

plotPCs(m = RUV3LoessRUV3LoessPCAModel,PCs = c("PC1","PC2","PC3"),colour = "l4$Barcode", title = "PCA of RUV3LoessRUV3Loess Normalized Data", legendTitle = "Barcode", xlim = c(-10,10), ylim=c(-10,10))

# grep("FBS",rownames(RUV3LoessRUV3LoessPCAModel$x[RUV3LoessRUV3LoessPCAModel$x[,"PC1"]>12,]),value=TRUE)

```

```{r SCC}

dt <- l4[,list(Barcode,Ligand,Spot_PA_SpotCellCountLog2, Spot_PA_SpotCellCountLog2RUV3, Spot_PA_SpotCellCountLog2RUV3Loess,Spot_PA_SpotCellCountLog2RUV3LoessRUV3, Spot_PA_SpotCellCountLog2RUV3LoessRUV3Loess  )]
dt <- melt(dt,id.vars=c("Barcode","Ligand"),measure.vars=c("Spot_PA_SpotCellCountLog2","Spot_PA_SpotCellCountLog2RUV3","Spot_PA_SpotCellCountLog2RUV3Loess","Spot_PA_SpotCellCountLog2RUV3LoessRUV3","Spot_PA_SpotCellCountLog2RUV3LoessRUV3Loess"), variable.name = "Processed",value.name = "SpotCellCount", variable.factor = FALSE)
dt$Processed[!grepl("RUV3",dt$Processed)] <- "RawLog2"
dt$Processed[(!grepl("Loess",dt$Processed))&grepl("RUV3$",dt$Processed)] <- "RUV3"
dt$Processed[(!grepl("LoessRUV3",dt$Processed))&grepl("RUV3Loess",dt$Processed)] <- "RUV3Loess"
dt$Processed[grepl("RUV3LoessRUV3$",dt$Processed)] <- "RUV3LoessRUV3"
dt$Processed[grepl("RUV3LoessRUV3Loess",dt$Processed)] <- "RUV3LoessRUV3Loess"

p <- ggplot(dt, aes(x = reorder(Barcode, SpotCellCount, FUN=median), y = SpotCellCount, colour = Ligand))+geom_boxplot()+
  ggtitle(paste("MEP Normalized Spot Cell Count by Barcode (full dataset)"))+
  xlab("")+ylab("")+
  facet_wrap(~Processed, ncol=1)+
  guides(colour=guide_legend(ncol=3))+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.3)))
suppressWarnings(print(p))

p <- ggplot(dt, aes(x = factor(Ligand), y = SpotCellCount, colour = Barcode))+geom_boxplot()+
  ggtitle(paste("MEP Normalized Spot Cell Count by Ligand (full dataset)"))+
  xlab("")+ylab("")+
  facet_wrap(~Processed, ncol=1)+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.3)))
suppressWarnings(print(p))

dt <- l4[,list(Barcode,ECMp,Spot_PA_SpotCellCountLog2, Spot_PA_SpotCellCountLog2RUV3, Spot_PA_SpotCellCountLog2RUV3Loess,Spot_PA_SpotCellCountLog2RUV3LoessRUV3, Spot_PA_SpotCellCountLog2RUV3LoessRUV3Loess  )]
dt <- melt(dt,id.vars=c("Barcode","ECMp"),measure.vars=c("Spot_PA_SpotCellCountLog2","Spot_PA_SpotCellCountLog2RUV3","Spot_PA_SpotCellCountLog2RUV3Loess","Spot_PA_SpotCellCountLog2RUV3LoessRUV3","Spot_PA_SpotCellCountLog2RUV3LoessRUV3Loess"), variable.name = "Processed",value.name = "SpotCellCount", variable.factor = FALSE)
dt$Processed[!grepl("RUV3",dt$Processed)] <- "RawLog2"
dt$Processed[(!grepl("Loess",dt$Processed))&grepl("RUV3$",dt$Processed)] <- "RUV3"
dt$Processed[(!grepl("LoessRUV3",dt$Processed))&grepl("RUV3Loess",dt$Processed)] <- "RUV3Loess"
dt$Processed[grepl("RUV3LoessRUV3$",dt$Processed)] <- "RUV3LoessRUV3"
dt$Processed[grepl("RUV3LoessRUV3Loess",dt$Processed)] <- "RUV3LoessRUV3Loess"

p <- ggplot(dt, aes(x = factor(ECMp), y = SpotCellCount))+geom_boxplot()+
  ggtitle(paste("MEP Normalized Spot Cell Count by ECM Protein (full dataset)"))+
  xlab("")+ylab("")+
  facet_wrap(~Processed, ncol=1)+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.3)))
#p <- p+geom_hline(yintercept = median(dt$SpotCellCount), colour="blue", alpha=.5)
suppressWarnings(print(p))


```

###Correlation Across Staining Sets
The raw, RUV3 and RUV3Loess versions of the spot cell count signal for each staining set are plotted against each other to show the correlation of results at the MEP level.


```{r compareDatasetsSCC, fig.height=3, fig.width=3}

plotSSs <- function(dt, signalName){
  #Organize the normalized spot cell count by staining sets
  dtc <- dcast(dt,MEP~StainingSet,value.var=signalName)
  xlim<-quantile(c(dtc$SS1,dtc$SS2,dtc$SS3),probs = c(.01,.99), na.rm = TRUE)
  ylim<-xlim
  
  p <- ggplot(dtc,aes(x=SS1,y=SS2))+
    geom_point(size=rel(.5), alpha=.5)+
    geom_smooth(method = "lm")+
    coord_cartesian(xlim, ylim)+
    annotate("text", label=paste0("r=",round(cor(dtc$SS1,dtc$SS2,method = "pearson", use="complete.obs"),2)), x = xlim[1]+.1*xlim[2], y = xlim[2], size = rel(3), colour="red")+
    xlab(paste("SS1",signalName))+ylab(paste("SS2",signalName))+
    ggtitle(paste(signalName, "of SS2 vs SS1"))+
    theme(axis.title=element_text(size=rel(.5)),axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)), plot.title = element_text(size = rel(.5)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.3)))
  suppressWarnings(print(p)) 
  
  p <- ggplot(dtc,aes(x=SS2,y=SS3))+
    geom_point(size=rel(.5), alpha=.5)+
    geom_smooth(method = "lm")+
    coord_cartesian(xlim, ylim)+ 
    annotate("text",label=paste0("r=",round(cor(dtc$SS2,dtc$SS3,method = "pearson", use="complete.obs"),2)), x = xlim[1]+.1*xlim[2], y = xlim[2], size = rel(3), colour="red")+
    xlab(paste("SS2",signalName))+ylab(paste("SS3",signalName))+
    ggtitle(paste(signalName, "of SS3 vs SS2"))+
    theme(axis.title=element_text(size=rel(.5)),axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)), plot.title = element_text(size = rel(.5)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.3)))
  suppressWarnings(print(p)) 
  
  p <- ggplot(dtc,aes(x=SS1,y=SS3))+
    geom_point(size=rel(.5), alpha=.5)+
    geom_smooth(method = "lm")+
    coord_cartesian(xlim, ylim)+
    annotate("text",label=paste0("r=",round(cor(dtc$SS1,dtc$SS3,method = "pearson", use="complete.obs"),2)), x = xlim[1]+.1*xlim[2], y = xlim[2], size = rel(3), colour="red")+
    xlab(paste("SS1",signalName))+ylab(paste("SS3",signalName))+
    ggtitle(paste(signalName, "of SS3 vs SS1"))+
    theme(axis.title=element_text(size=rel(.5)),axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)), plot.title = element_text(size = rel(.5)),legend.text=element_text(size = rel(.3)),legend.title=element_text(size = rel(.3)))
  suppressWarnings(print(p)) 
}

tmp <- plotSSs(dt=l4,signalName = "Spot_PA_SpotCellCountLog2")
tmp <- plotSSs(dt=l4,signalName = "Spot_PA_SpotCellCountLog2RUV3")
tmp <- plotSSs(dt=l4,signalName = "Spot_PA_SpotCellCountLog2RUV3Loess")
tmp <- plotSSs(dt=l4,signalName = "Spot_PA_SpotCellCountLog2RUV3LoessRUV3")
tmp <- plotSSs(dt=l4,signalName = "Spot_PA_SpotCellCountLog2RUV3LoessRUV3Loess")


tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_IntegratedIntensity_Dapi")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_IntegratedIntensity_DapiRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_IntegratedIntensity_DapiRUV3Loess")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_IntegratedIntensity_DapiRUV3LoessRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_IntegratedIntensity_DapiRUV3LoessRUV3Loess")

tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_MedianIntensity_Dapi")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_MedianIntensity_DapiRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_MedianIntensity_DapiRUV3Loess")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_MedianIntensity_DapiRUV3LoessRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_Intensity_MedianIntensity_DapiRUV3LoessRUV3Loess")


tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_AreaShape_Eccentricity")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_AreaShape_EccentricityRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_AreaShape_EccentricityRUV3Loess")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_AreaShape_EccentricityRUV3LoessRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_CP_AreaShape_EccentricityRUV3LoessRUV3Loess")

tmp <- plotSSs(dt=l4,signalName = "Nuclei_PA_Cycle_DNA2NProportionLogit")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_PA_Cycle_DNA2NProportionLogitRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_PA_Cycle_DNA2NProportionLogitRUV3Loess")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_PA_Cycle_DNA2NProportionLogitRUV3LoessRUV3")
tmp <- plotSSs(dt=l4,signalName = "Nuclei_PA_Cycle_DNA2NProportionLogitRUV3LoessRUV3Loess")

```